function makeDifferenceGraph(a,b,c,d,e){function t(){var a="rgb(100, 100, 100)";g.save(),g.lineWidth=2,g.strokeStyle=a,g.fillStyle=a,g.textAlign="end";for(var b=-m;b<l+1;b++)g.fillText(b*n,x(-.3),y(b*n));for(g.beginPath(),g.moveTo(x(0),0),g.lineTo(x(0),d),g.moveTo(x(0),y(0)),g.lineTo(e,y(0)),b=0;b<h;b++)g.moveTo(x(b+1),y(0)+.0125*d),g.lineTo(x(b+1),y(0)-.0125*d);g.stroke(),g.restore()}function u(){g.save(),g.strokeStyle=r,g.fillStyle=r,g.beginPath(),g.lineWidth=3,g.moveTo(x(0),y(0));for(var a=0;a<h;a++)g.lineTo(x(a+1),y(i[a]));g.stroke(),g.restore()}function v(){g.save(),g.font="10pt Calibri",g.fillStyle="white",g.textAlign="center";for(var a=0;a<h;a++)g.fillText(i[a],x(a+1),y(i[a])+.04*d*Math.pow(-1,(a+1)%2+!b));g.restore()}function w(){g.save(),g.font="bold 14pt Calibri",g.fillStyle="black",g.fillRect(1.5*e/16,.025*d,.155*e,.07*d),g.fillRect(1.5*e/16,.925*d,.115*e,.07*d),g.fillStyle=B(c[0]),g.fillText("Winning",1.5*e/16,.075*d),g.fillStyle=B(c[1]),g.fillText("Losing",1.5*e/16,.925*d),g.restore()}function x(a){return e/16*(14.5*a/h+1)}function y(a){return d/10*(-1.1*a/n+l+1)}function z(a){return a.unshift(0),a.slice(1).map(function(c,d){return Math.pow(-1,d%2+!b)*(c-a[d])})}function A(a,b,c){for(var d=[],e=0;e<a.length;e++)d.push(Math.round(c*a[e]+(1-c)*b[e]));return d}function B(a){var b=a.map(function(a){return Math.round(a)});return"rgb("+b[0]+","+b[1]+","+b[2]+")"}var f=document.querySelector("#difference-plot"),g=f.getContext("2d");f.width=e,f.height=d,g.lineJoin="round",g.font="12pt Calibri",g.textBaseline="middle";for(var h=a.length,i=z(a),j=Math.max.apply(null,i),k=Math.min.apply(null,i),l=Math.round(8*j/(j-k)),m=8-l,n=Math.ceil(Math.max(0===l?0:j/l,0===m?0:Math.abs(k)/m)),o=.25,p=[0,.1,.499,.5,.501,.9,1],q=[[255,255,255],c[0],A([0,0,0],c[0],o),[0,0,0],A([0,0,0],c[1],o),c[1],[255,255,255]],r=g.createLinearGradient(0,l>m?0:d/10*(l-m),0,l>m?d/10*(1+l)*2:d),s=0;s<q.length;s++)r.addColorStop(p[s],B(q[s]));u(),t(),v(),w()}function makeIndividualGraph(a,b,c,d,e){function l(){var a="rgb(100, 100, 100)";g.save(),g.lineWidth=2,g.strokeStyle=a,g.fillStyle=a,g.textAlign="end";for(var b=0;b<i+1;b++)g.fillText(b*k,q(-.3),r(b*k));for(g.beginPath(),g.moveTo(q(0),0),g.lineTo(q(0),r(0)),g.moveTo(q(0),r(0)),g.lineTo(e,r(0)),b=0;b<h;b++)g.moveTo(q(b+1),r(0)+.0125*d),g.lineTo(q(b+1),r(0)-.0125*d);g.stroke(),g.restore()}function m(a){g.save(),g.lineWidth=2,g.beginPath(),g.strokeStyle=t(c[a]),g.fillStyle=t(c[a]),g.moveTo(q(d),r(0));for(var b=s(a),d=0;d<b.length;d++)g.lineTo(q(d),r(b[d]));g.stroke(),g.restore()}function n(){g.save(),g.font="12pt Calibri",g.fillStyle="gray",g.fillText("played",.125*e,.15*d),g.beginPath(),g.arc(.1*e,.15*d,.015*d,0,2*Math.PI),g.fill(),g.lineWidth=1.5,g.strokeStyle="gray",g.fillText("waited",.125*e,.225*d),g.beginPath(),g.arc(.1*e,.225*d,.015*d,0,2*Math.PI),g.stroke(),g.font="14pt Calibri",g.fillText("Legend",1.4*e/16,.075*d),g.restore()}function o(){g.save(),g.fillStyle="rgb(0, 0, 0)",g.lineWidth=4;for(var e=1;e<h;e++)g.beginPath(),g.strokeStyle=t(c[(e+!b)%2]),g.arc(q(e),r(a[e-1]),.015*d,0,2*Math.PI),g.stroke(),g.arc(q(e),r(a[e]),.01*d,0,2*Math.PI),g.fill();g.restore()}function p(){g.save();for(var e=1;e<h;e++)g.beginPath(),g.fillStyle=t(c[(e+b)%2]),g.arc(q(e),r(a[e]),.015*d,0,2*Math.PI),g.fill();g.restore()}function q(a){return e/16*(14.5*a/(h-1)+1)}function r(a){return d/10*(-a/k+i+1)}function s(c){for(var d=[],e=1*(c!=b);e<=h;e+=2)d.push(a[e]),d.push(a[e]);return c!=b&&d.pop(),c!=b?d.unshift(0):d.pop(),d}function t(a){var b=a.map(function(a){return Math.round(a)});return"rgb("+b[0]+","+b[1]+","+b[2]+")"}var f=document.querySelector("#individual-plot"),g=f.getContext("2d");f.width=e,f.height=d,g.lineJoin="round",g.font="12pt Calibri",g.textBaseline="middle";var h=a.length,i=8,j=Math.max.apply(null,a),k=Math.ceil(j/i);l(),n(),m(0),m(1),o(),p()}function setMenuValue(a,b,c,d){var e=a.id.match(/-(.*)/)[1];window[b]=e,e!=d&&(document.querySelector("#"+c+"-"+d).style.textDecoration="none",document.querySelector("#"+c+"-"+e).style.textDecoration="underline",resetBoard())}function setDifficulty(){setMenuValue(this,"difficulty","difficulty",difficulty),makeScoringCell.setAIColor(),document.querySelector("#move-ai").childNodes[1].style.color=vec2rgb(makeScoringCell.player_colors[1])}function setSize(){setMenuValue(this,"board_size","size",board_size)}function setFirstMove(){setMenuValue(this,"first_move","move",first_move)}function showGameOverMessage(){var a=document.querySelector("#game-over-message"),b="Draw.";a.style.color="white",score[0]>score[1]?(b="You won!",a.style.color=vec2rgb(makeScoringCell.player_colors[0])):score[0]<score[1]&&(b="You lost.",a.style.color=vec2rgb(makeScoringCell.player_colors[1])),a.innerHTML=b}function makeGraphics(){var a=.4*document.querySelector("#board").offsetHeight,b=document.querySelector("#board").offsetWidth,c=game_log.map(function(a){return a.score});c.splice(0,2),"medium"==board_size?(c.push(score[1*("you"==first_move)]),c.push(score[1*("you"!=first_move)])):(c.push(score[1*("you"!=first_move)]),c.push(score[1*("you"==first_move)])),makeDifferenceGraph(c,"you"==first_move,makeScoringCell.player_colors,a,b),makeIndividualGraph(c,"you"==first_move,makeScoringCell.player_colors,a,b)}function resetBoard(){game_over&&(document.querySelector("#move-"+first_move).style.textDecoration="none",first_move="you"==first_move?"ai":"you",document.querySelector("#move-"+first_move).style.textDecoration="underline"),score=[0,0],game_log=[],game_over=!1,document.querySelector("#score0").innerHTML="You: 0",document.querySelector("#score1").innerHTML="AI: 0";var a=document.querySelector("#board-container"),b=document.querySelector("#board");switch(a.removeChild(b),board_size){case"small":makeBoard(4,4),n_rounds=16;break;case"medium":makeBoard(5,5),n_rounds=25;break;case"large":makeBoard(6,6),n_rounds=36;break;default:throw"board size not defined"}document.querySelector("#game-over-message").innerHTML="",document.querySelector("#stats-button").className="off",document.querySelector("#statistics-overlay").style.display="none"}function easeElement(a,b="out",c=1,d=3){function j(){e+=f,h="out"==b?1-Math.pow(e,d):Math.pow(e,d),e>=1?(a.style.opacity=1-g,a.style.filter="alpha(opacity="+100*(1-g)+")",cancelAnimationFrame(i)):(a.style.opacity=h,a.style.filter="alpha(opacity="+100*h+")",i=requestAnimationFrame(j))}var e=0,f=1/60/c,g=1*("out"==b),h=g;a.style.opacity=g,a.style.filter="alpha(opacity="+100*g+")";var i=requestAnimationFrame(j)}function cvx_comb(a,b,c){for(var d=[],e=0;e<a.length;e++)d.push(Math.round(c*a[e]+(1-c)*b[e]));return d}function vec2rgb(a){return"rgb("+a[0]+","+a[1]+","+a[2]+")"}function vec2rgba(a){return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"}var game_over=!1,first_move="you",board_size="small",difficulty="medium",score=[0,0],n_rounds=0,game_log=[];window.onresize=function(){makeScoringCell.resizeCanvas(),game_over&&makeGraphics()},document.querySelector("body").onload=function(){switch(document.querySelector("#difficulty-"+difficulty).style.textDecoration="underline",board_size){case"small":makeBoard(4,4),n_rounds=16;break;case"medium":makeBoard(5,5),n_rounds=25;break;case"large":makeBoard(6,6),n_rounds=36;break;default:throw"board size not defined"}document.querySelector("#size-"+board_size).style.textDecoration="underline",document.querySelector("#move-"+first_move).style.textDecoration="underline",document.querySelector("#move-ai").onmouseover=function(a){a.target.style.color=vec2rgb(makeScoringCell.player_colors[1])},document.querySelector("#move-ai").onmouseleave=function(a){a.target.style.color="white"},requestId=makeScoringCell.animateCell()},document.querySelector("#ai-difficulty").childNodes.forEach(function(a){a.onclick=setDifficulty}),document.querySelector("#board-size").childNodes.forEach(function(a){a.onclick=setSize}),document.querySelector("#first-move").childNodes.forEach(function(a){a.onclick=setFirstMove}),document.querySelector("#statistics-overlay").onclick=function(a){document.querySelector("#statistics-overlay").style.display="none"},document.querySelector("#reset-button").onclick=resetBoard,document.querySelector("#stats-button").onclick=function(){if(game_over){var a=document.querySelector("#statistics-overlay");"flex"==a.style.display?a.style.display="none":(a.style.display="flex",makeGraphics())}};var makeBoard=function(a,b){function h(c){var d=Math.floor(c/b),e=c%b;return e>1&&e<b-2&&d>1&&d<a-2}function s(){var a=this.ind0,b=d.indexOf(a);b>=0&&!c&&(c=!0,setTimeout(function(){c=!1},1e3),d.splice(b,1),t(a,0),setTimeout(function(){a=x(),b=d.indexOf(a),d.splice(b,1),t(a,1)},750))}function t(a,b){if(!game_over){game_log.push({move:a,player:b,score:score[b]}),e++,i[a].player=b,e==n_rounds&&(game_over=!0),document.querySelector("#new-cell-img-"+a).className="single-cell new",document.querySelector("#old-cell-img-"+a).className="single-cell old",z(b,v(b,a));for(var c=0;c<8;c++){var d=a+f[c],g=a+2*f[c];if(i[d].openness--,j[b][d].overlap++,i[d].player==b){if(i[a].connections[Math.floor(c/2)]+=1,i[d].connections[Math.floor(c/2)]+=1,j[b][a-f[c]].extensions++,j[b][g].extensions++,j[b][d].unconnected==-1){j[b][d].unconnected=0;for(var h=0;h<8;h++)j[b][d+f[h]].unconnected=0}1==i[d].connections[Math.floor(c/2)]&&y(d)}i[g].player==b&&j[b][d].interlap++}var k=0==i[a].connections.reduce((a,b)=>a+b,0);if(j[b][a].unconnected=k?-1:0,k)for(var c=0;c<8;c++)j[b][a+f[c]].unconnected++;y(a),game_over&&(setTimeout(showGameOverMessage,1e3),document.querySelector("#stats-button").className="")}}function u(){var a=game_log.pop(),b=a.move,c=a.player,g=a.score;if(d.push(b),d.sort(),e--,i[b].player=2,document.querySelector("#new-cell-img-"+b).className="single-cell on new",document.querySelector("#old-cell-img-"+b).className="single-cell on old",document.querySelector("#cell-text-"+b).className="cell-text on",score[c]=g,document.querySelector("#score"+c).innerHTML=(0==c?"You: ":"AI: ")+score[c],j[c][b].unconnected==-1){j[c][b].unconnected=0;for(var k=0;k<8;k++)j[c][b+f[k]].unconnected=0}for(var k=0;k<8;k++){var l=b+f[k],m=b+2*f[k];if(i[l].openness++,j[c][l].overlap--,i[l].player==c){if(i[b].connections[Math.floor(k/2)]-=1,i[l].connections[Math.floor(k/2)]-=1,j[c][b-f[k]].extensions--,j[c][m].extensions--,0==i[l].connections.reduce((a,b)=>a+b,0)){j[c][l].unconnected=-1;for(var n=0;n<8;n++)j[c][l+f[n]].unconnected++}0==i[l].connections[Math.floor(k/2)]&&y(l)}i[m].player==c&&j[c][l].interlap--,h(l)&&(document.querySelector("#cell-text-"+l).innerHTML=v(0,l))}document.querySelector("#cell-text-"+b).innerHTML=v(0,b),y(b)}function v(a,b){var c=j[a][b];return(0==c.overlap)-c.unconnected+4*c.overlap-2*(c.interlap+c.extensions)}function w(a,b){var c=v(0,b),d=v(1,b),e=10*d+5*c,f=2*d+2*c+.01*i[b].openness;switch(difficulty){case"easy":return e;case"medium":return.5*e+.5*f;case"hard":return f;default:return.25*e+.75*f}}function x(){for(var a=0,b=0,c=0,e=0,f=0;f<d.length;f++)e=d[f],b=w(1,e),b>a&&(a=b,c=e);return c}function y(a){var b=document.querySelector("#old-cell-img-"+a),c=document.querySelector("#new-cell-img-"+a);b.src=c.src,b.onload=function(){easeElement(b,"out",1,2)},c.src="images/"+g[i[a].player]+i[a].connections.map(function(a){return 1*(a>0)}).join("")+".png",c.onload=function(){easeElement(c,"in",1,2)}}function z(a,b){function g(){c+=1/30,score[a]+=d,c>=.95?(score[a]=Math.round(score[a]),cancelAnimationFrame(f)):requestAnimationFrame(g),e.innerHTML=(0==a?"You":"AI")+": "+Math.ceil(score[a])}var c=0,d=b/30,e=document.querySelector("#score"+a),f=requestAnimationFrame(g)}function A(a){var c=Math.floor(a/(b-4))+2,d=a%(b-4)+2;return d*b+c}a+=4,b+=4;var c=!1,d=[],e=0,f=[-1,1,-b,b,-b-1,b+1,-b+1,b-1],g=["g"];switch(difficulty){case"easy":g.push("b");break;case"medium":g.push("f");break;case"hard":g.push("r");break;default:throw"player difficulty not defined"}g.push("o");for(var i=new Array(a*b),j=[new Array(a*b),new Array(a*b)],k=0;k<a*b;k++)if(j[0][k]={overlap:0,interlap:0,unconnected:0,extensions:0},j[1][k]={overlap:0,interlap:0,unconnected:0,extensions:0},i[k]={player:2,openness:8,connections:[0,0,0,0]},h(k))for(var l=0;l<8;l++)h(k+f[l])||i[k].openness--;var m=document.createElement("div");m.id="board";for(var k=0;k<(a-4)*(b-4);k++){var n=A(k);d.push(n);var o=document.createElement("div");o.className="cell-container",o.style.width=100/(a-4)+"%",o.ind0=n,o.onclick=s;var p=document.createElement("img");p.id="old-cell-img-"+n,p.className="single-cell on old",p.src="images/o0000.png";var q=document.createElement("img");q.id="new-cell-img-"+n,q.className="single-cell on new",q.src="images/o0000.png",o.appendChild(q),o.appendChild(p),m.appendChild(o),document.querySelector("#board-container").appendChild(m)}if(d.sort(),"ai"==first_move){var n=x(),r=d.indexOf(n);d.splice(r,1),t(n,1)}document.querySelector("#undo-button").onclick=function(){return e<2?void console.log("Not enough moves to undo."):(u(),game_over&&"medium"==board_size||u(),void(game_over&&(document.querySelector("#statistics-overlay").style.display="none",document.querySelector("#stats-button").className="off",game_over=!1)))}},makeScoringCell=function(){function u(){m.width=l,m.height=l,q=.75,r=[{x:.22*l,y:.78*l,theta:Math.PI/4,radius:.15*l},{x:.78*l,y:.78*l,theta:-Math.PI/3,radius:.15*l},{x:.78*l,y:.22*l,theta:-Math.PI/2,radius:.15*l},{x:.22*l,y:.22*l,theta:Math.PI,radius:.15*l}],s=l/2,t=l/2}function C(){switch(difficulty){case"easy":base_color1=[34,142,250];break;case"medium":base_color1=[230,54,230];break;case"hard":base_color1=[255,60,0];break;default:base_color1=[255,255,0]}a.player_colors=[B,base_color1],document.querySelector("#score1").style.color=vec2rgb(base_color1)}function D(){var a=document.querySelector("#scoring-cell").offsetHeight;a!=l&&(l=a,u())}function E(){H(),F(),n.clearRect(0,0,m.width,m.height),n.translate(l/2,l/2),n.rotate(2*Math.PI/3600),n.translate(-l/2,-l/2),n.fillStyle=y,G(n),n.fillStyle=z,G(n),requestId=requestAnimationFrame(E)}function F(){var a=Math.min(Math.abs(score[0]-score[1])/A,1),b=score[0]>score[1]?B:base_color1,c=cvx_comb(x,b,v),d=cvx_comb(w,c,1-Math.pow(a,.25)),e=cvx_comb(w,b,1-Math.pow(a,.25));y=n.createRadialGradient(o,p,0,o,p,l),y.addColorStop(0,vec2rgb(e)),y.addColorStop(1,vec2rgb(d));var f=[255,255,255],g=cvx_comb(w,x,.01);f.push(0),g.push(.5+.25*Math.pow(1-a,.25)),z=n.createRadialGradient(o,p,0,o,p,.9*l),z.addColorStop(0,vec2rgba(f)),z.addColorStop(1,vec2rgba(g))}function G(a){var b,c,d,e,f=r.length;a.beginPath();for(var g=0;g<f;g++)b=r[g%f],c=r[(g+1)%f],cpx=b.radius*Math.cos(b.theta)+b.x,cpy=b.radius*Math.sin(b.theta)+b.y,d=-c.radius*Math.cos(c.theta)+c.x,e=-c.radius*Math.sin(c.theta)+c.y,0===g&&a.moveTo(b.x,b.y),a.bezierCurveTo(cpx,cpy,d,e,c.x,c.y);a.fill()}function H(){i=e,j=f,k=g,e=b*(j-i)*h+i,f=(c*i-j-i*k)*h+j,g=(i*j-d*k)*h+k;for(var a=0;a<r.length;a++)row=r[a],row.radius=q*Math.sqrt(Math.pow(row.y-p,2)+Math.pow(row.x-o,2)),row.theta=Math.atan2(row.y-p,row.x-o)-Math.PI/2;o=.015*l*f+.5*l,p=-.015*l*g+.85*l;var m=Math.sqrt(Math.pow(t-p,2)+Math.pow(s-o,2))/l;m>.01&&(o=s+.01*(o-s)/m,p=t+.01*(p-t)/m),s=o,t=p}var i,j,k,o,p,q,r,s,t,a={},b=10,c=28,d=8/3,e=Math.random(),f=10,g=20,h=.015,l=document.querySelector("#scoring-cell").offsetHeight,m=document.querySelector("#scoring-canvas"),n=m.getContext("2d");u();var v=.5,w=[255,255,255],x=[0,0,0],y="white",z="white",A=10,B=[34,255,34];return C(),a.setAIColor=C,a.resizeCanvas=D,a.animateCell=E,a.updateGradient=F,a}();